#!/bin/bash

# Проверка, был ли передан путь к файлу для поиска символьных ссылок
if [ -z "$1" ]; then
    echo "Укажите путь к файлу для поиска символьных ссылок."
    exit 1
fi

# Путь к файлу для поиска символьных ссылок
target_file="$1"

# Проверка, существует ли целевой файл
if [ ! -e "$target_file" ]; then
    echo "Файл '$target_file' не существует."
    exit 1
fi

# Проверка, был ли передан файл для записи вывода
if [ -z "$2" ]; then
    echo "Укажите файл для записи вывода."
    exit 1
fi

# Файл для записи вывода
output_file="$2"

# Очищаем или создаем файл для вывода
> "$output_file"

# Поиск символьных ссылок, указывающих на целевой файл
find / -type l -ls 2>/dev/null | grep -E "\-> $target_file$" | while read -r symlink; do
    # Записываем результат в файл
    echo "Символьная ссылка: $symlink" >> "$output_file"
done

# Подсчитываем количество строк "Символьная ссылка:" в файле output_file
link_count=$(grep -c "Символьная ссылка:" "$output_file")

# Записываем количество найденных символьных ссылок в файл
echo "Количество символьных ссылок на файл '$target_file': $link_count" >> "$output_file"

# Выводим количество символьных ссылок в консоль
echo "Количество символьных ссылок на файл '$target_file': $link_count"

# Выводим информацию о завершении поиска
echo "Поиск завершен. Результаты записаны в файл: $output_file"

